#!/usr/bin/env bash
#
# Helper script to print the password for a wifi network on macOS
#
# Apache licensed.
#
# Copyright 2015-2025 Joe Block <jpb@unixorn.net>
#
# This has only been tested on OS X 10.10 Yosemite since I don't have
# anything older.

set -o pipefail
source tumult-functions


only-run-on darwin
check-dependency security

debug "Searching for '${1}' in keychain"
security find-generic-password -ga "$1" 2>&1 | \
    grep 'password:' | \
    cut -c11-
result=$?
debug "result: $result"
if [[ $result != 0 ]]; then
    fail "Couldn't find $1 in your keychain!"
fi
