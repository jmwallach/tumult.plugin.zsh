#!/usr/bin/env bash
#
# Set wallpaper
#
# Copyright 2025, Joe Block <jpb@unixorn.net>

set -o pipefail
source tumult-functions

if [[ -n "$DEBUG" ]]; then
  # shellcheck disable=SC2086
  if [[ "$(echo $DEBUG | tr '[:upper:]' '[:lower:]')" == "verbose" ]]; then
    set -x
  fi
fi



}






function usage() {
  echo "Usage: $(my-name) /path/to/file"
}

only-run-on Darwin
check-dependencies defaults file killall sqlite3

if [[ ! -f "$HOME/Library/Application\ Support/Dock/desktoppicture.db" ]]; then
  fail "$HOME/Library/Application\ Support/Dock/desktoppicture.db is missing!"
fi

if [[ $# != 1 ]]; then
  usage
  exit 13
fi

image_f=$1
if file -I "$image_f" | grep -q "image/"; then
  sqlite3 "$HOME/Library/Application\ Support/Dock/desktoppicture.db" "update data set value = '$image_f'" && killall Dock
else
  fail "$image_f is not an image."
fi
